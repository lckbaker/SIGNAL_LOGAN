version: 1
name: triage
 
tech_email_addresses: jian.song@nih.gov,samuel.katz@nih.gov 
mgmt_email_addresses: jian.song@nih.gov,samuel.katz@nih.gov
monarch_team_id: 5c8946358e735a001c5e1855
monarch_product_id: 5c8949c0197b90001c4b4a5a
 
docker_build:
  variables:
    IMAGE_REPO: lsb-triage
    REGISTRY_USER: songj11
docker_scan:
  cve_whitelist:
    - NODE-SECURITY-1184 #https://www.npmjs.com/advisories/1164
    - NODE-SECURITY-1164 #https://www.npmjs.com/advisories/1164
    - CVE-2019-11358  # Jquery Cross-site scripting (XSS) vulnerability
    - CVE-2018-12121
    - CVE-2018-12122
    - CVE-2018-14040  # bootstrap.js Cross-Site Scripting (XSS) Vulnerability
    - CVE-2018-14042  # bootstrap.js Cross-Site Scripting (XSS) Vulnerability
    - CVE-2018-12123
    - CVE-2018-7159
    - CVE-2017-9801 #https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2017-9801
    - NODE-SECURITY-886 #https://www.npmjs.com/advisories/886
    - CVE-2019-13173 #https://www.npmjs.com/advisories/886
    - NODE-SECURITY-1066 #https://www.npmjs.com/advisories/1066
    - CVE-2019-10744 #https://www.npmjs.com/advisories/1065
webapp_scan:
  variables:
    NS_URL: 'https://triage.niaidawsqa.net/'
  whitelist:
     - Out-of-date Version (Bootstrap):
       - 'https://triage.niaidawsqa.net/' 
     - Out-of-date Version (jQuery):
       - 'https://triage.niaidawsqa.net/' 
approved_for_prod: true

terraform:
  modules:
    - web-application
  module_name: triage # legacy, not needed for new apps
  variables:
    cpu: 512
    memory: 4096
    container_port: 3838
    desired_count: 1
    command: /usr/local/bin/shiny_server.sh
    alert_recipients: "[[${var.tech_email_addresses},${var.mgmt_email_addresses}]]"
    healthcheck_timeout: 25
    healthcheck_healthy_threshold: 2
    healthcheck_unhealthy_threshold: 6
  environments:
    qa:
      variables:
        image: "[[${var.pre_prod_image_base}]]"
    prod:
      variables:
        cpu: 128
        image: "[[${var.prod_image_base}]]"
        use_public_ssl_cert: true
        url_to_monitor: "triage-pilot.niaid.nih.gov"
        security_group_name: "external_elb"
